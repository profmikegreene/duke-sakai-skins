function footerDetailsPanelEscHandler(e){27===e.keyCode&&toggleFooterDetailsPanel(e)}function toggleFooterDetailsPanel(e){e.preventDefault(),$PBJQ("#Mrphs-footer--details__panel").toggleClass("Mrphs-footer--details__panel-show"),$PBJQ("#Mrphs-footer--details__panel").hasClass("Mrphs-footer--details__panel-show")?($PBJQ(document).on("keyup",footerDetailsPanelEscHandler),$PBJQ("#Mrphs-footer--details__close").focus()):($PBJQ(document).off("keyup",footerDetailsPanelEscHandler),$PBJQ("#Mrphs-footer--details__info").focus())}var selectSiteModalLinks,selectSiteLastModalInTab;console.log("hello from duke-default.js"),function(e){if(("object"==typeof qtip||"object"==typeof moment||"object"==typeof portal)&&"undefined"!=typeof moment){moment.locale(portal.locale),portal.socialBullhorn=$PBJQ("#Mrphs-social-bullhorn"),portal.academicBullhorn=$PBJQ("#Mrphs-academic-bullhorn");var l=function(e){return moment(e).format("L LT")};portal.wrapNoAlertsString=function(e){return'<div class="portal-bullhorn-no-alerts">'+e+"</div>"},portal.clearBullhornAlert=function(n,i,a){$PBJQ.get("/direct/portal/clearBullhornAlert",{id:i}).done(function(){var e=$PBJQ("#portal-bullhorn-alert-"+i),t=1===$PBJQ(".portal-bullhorn-"+n+"-alert").length;e.remove(),t&&$PBJQ(".portal-bullhorn-"+n+"-alerts").html(portal.wrapNoAlertsString(a));var o=$PBJQ(".portal-bullhorn-"+n+"-alert").length;portal.setCounter(n,o)})},portal.clearAllAlerts=function(e,t){$PBJQ.ajax({url:"/direct/portal/clearAll"+e+"Alerts",cache:!1}).done(function(){$PBJQ(".portal-bullhorn-"+e.toLowerCase()+"-alerts").html(portal.wrapNoAlertsString(t)),portal.setCounter(e.toLowerCase(),0)})},portal.acceptFriendRequest=function(e,t,o,n){confirmFriendRequest(t,e),this.clearBullhornAlert(portal.SOCIAL,o,n)},portal.ignoreFriendRequest=function(e,t,o,n){ignoreFriendRequest(t,e),this.clearBullhornAlert(portal.SOCIAL,o,n)},$PBJQ(document).ready(function(){portal.socialBullhorn.qtip({suppress:!1,position:{adjust:{scroll:!1},my:"top right",at:"bottom left",target:portal.socialBullhorn},show:{event:"click",delay:0,solo:portal.academicBullhorn},style:{classes:"portal-bullhorns"},hide:{event:"click unfocus"},content:{text:function(e,n){return $PBJQ.ajax({url:"/direct/portal/socialAlerts.json",cache:!1}).then(function(o){if(o.message&&"NO_ALERTS"===o.message)return portal.wrapNoAlertsString(o.i18n.noAlerts);var n='<div class="portal-bullhorn-social-alerts">';return o.alerts.forEach(function(e){"profile.friend.request"===e.event?n+='<a href="javascript:;" class="portal-bullhorn-connectionmanager-pending">':"profile.friend.confirm"===e.event?n+='<a href="javascript:;" class="portal-bullhorn-connectionmanager-current">':n+='<a href="'+e.url+'">',n+='<div id="portal-bullhorn-alert-'+e.id+'" class="portal-bullhorn-social-alert"><div class="portal-bullhorn-photo" style="background-image:url(/direct/profile/'+e.from+'/image/thumb)"></div><div class="portal-bullhorn-content"><div class="portal-bullhorn-message"><span class="portal-bullhorn-display-name">'+e.fromDisplayName+"</span>","profile.wall.item.new"===e.event?n+=o.i18n.wallPost:"profile.status.update"===e.event?n+=o.i18n.statusUpdate:"profile.wall.item.comment.new"===e.event?n+=o.i18n.postComment:"profile.friend.request"===e.event?n+=o.i18n.friendRequest:"profile.friend.confirm"===e.event?n+=o.i18n.friendConfirm:"profile.message.sent"===e.event?n+=o.i18n.message:"commons.comment.created"===e.event?n+=o.i18n.commentCreated:n+=o.i18n.unrecognisedAlert;var t=l(e.eventDate);n+='</div><div class="portal-bullhorn-time">'+t+'</div><div class="portal-bullhorn-options">',"profile.friend.request"===e.event&&(n+='<a href="javascript:;" onclick="portal.acceptFriendRequest(\''+e.from+"','"+e.to+"','"+e.id+"','"+o.i18n.noAlerts+"');\">"+o.i18n.accept+"</a>",n+='<a href="javascript:;" onclick="portal.ignoreFriendRequest(\''+e.from+"','"+e.to+"','"+e.id+"','"+o.i18n.noAlerts+"');\">"+o.i18n.ignore+"</a>"),n+="</div>",n+='</div><div class="portal-bullhorn-clear"><a href="javascript:;" onclick="portal.clearBullhornAlert(\'social\', \''+e.id+"','"+o.i18n.noAlerts+'\');" title="'+o.i18n.clear+'"><i class="fa fa-times" aria-hidden="true"></i></a></div></div></a>'}),n+='<div id="portal-bullhorn-clear-all"><a href="javascript:;" onclick="portal.clearAllAlerts(\'Social\',\''+o.i18n.noAlerts+"');\">"+o.i18n.clearAll+"</a></div>",n+="</div>"},function(e,t,o){n.set("content.text",t+": "+o)})}},events:{visible:function(e,t){$PBJQ(".portal-bullhorn-connectionmanager-pending").click(function(e){portal.connectionManager.show({state:"pending"}),t.hide()}),$PBJQ(".portal-bullhorn-connectionmanager-current").click(function(e){portal.connectionManager.show(),t.hide()})}}}),portal.academicBullhorn.qtip({suppress:!1,position:{adjust:{scroll:!1},my:"top right",at:"bottom left",target:portal.socialBullhorn},show:{event:"click",delay:0,solo:portal.socialBullhorn},style:{classes:"portal-bullhorns"},hide:{event:"click unfocus"},content:{text:function(e,n){return $PBJQ.ajax({url:"/direct/portal/academicAlerts.json",dataType:"json",cache:!1}).then(function(r){if(r.message&&"NO_ALERTS"===r.message)return portal.wrapNoAlertsString(r.i18n.noAlerts);var s='<div class="portal-bullhorn-academic-alerts">';return r.alerts.forEach(function(e){var t=e.title,o=e.siteTitle,n="fa-bullhorn";"asn.new.assignment"===e.event||"asn.grade.submission"===e.event?n="fa-file-text":"lessonbuilder.comment.create"===e.event&&(n="fa-leanpub"),s+='<a href="'+e.url+'" style="text-decoration: none;"><div id="portal-bullhorn-alert-'+e.id+'" class="portal-bullhorn-academic-alert"><div class="portal-bullhorn-icon fa fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa '+n+' fa-stack-1x fa-inverse"></i></div><div class="portal-bullhorn-content"><div class="portal-bullhorn-message"><span class="portal-bullhorn-display-name">'+e.fromDisplayName+"</span>";var i="";"annc.new"===e.event?i=r.i18n.announcement.replace("{0}",t).replace("{1}",o):"asn.new.assignment"===e.event?i=r.i18n.assignmentCreated.replace("{0}",t).replace("{1}",o):"asn.grade.submission"===e.event?i=r.i18n.assignmentSubmissionGraded.replace("{0}",t).replace("{1}",o):"commons.comment.created"===e.event?s+=r.i18n.academicCommentCreated.replace("{0}",o):"lessonbuilder.comment.create"===e.event?s+=r.i18n.academicLessonBuilderCommentCreate.replace("{0}",o):s+=r.i18n.unrecognisedAlert;var a=l(e.eventDate);s+=i+'</div><div class="portal-bullhorn-time">'+a+"</div>",s+='</div><div class="portal-bullhorn-clear"><a href="javascript:;" onclick="portal.clearBullhornAlert(\'academic\', \''+e.id+"','"+r.i18n.noAlerts+'\');" title="'+r.i18n.clear+'"><i class="fa fa-times" aria-hidden="true"></i></a></div></div></a>'}),s+='<div id="portal-bullhorn-clear-all"><a href="javascript:;" onclick="portal.clearAllAlerts(\'Academic\',\''+r.i18n.noAlerts+"');\">"+r.i18n.clearAll+"</a></div>",s+="</div>"},function(e,t,o){n.set("content.text",t+": "+o)})}}})}),portal.setCounter=function(e,t){var o=$PBJQ("#Mrphs-"+e+"-bullhorn"),n="social"===e?"blue":"red";o.find(".bullhorn-counter").remove(),o.append('<span class="bullhorn-counter bullhorn-counter-'+n+'">'+t+"</span>")};var t=function(){$PBJQ.ajax({url:"/direct/portal/bullhornCounts.json",cache:!1,data:{auto:!0}}).done(function(e){(portal.failedBullhornCounts=0)<e.academic?portal.setCounter("academic",e.academic):portal.academicBullhorn.find(".bullhorn-counter").remove(),0<e.social?portal.setCounter("social",e.social):portal.socialBullhorn.find(".bullhorn-counter").remove()}).fail(function(e,t,o){console.log("Failed to get the bullhorn counts. Status: "+t),console.log("FAILED ERROR: "+o),portal.failedBullhornCounts=portal.failedBullhornCounts||0,portal.failedBullhornCounts+=1,3==portal.failedBullhornCounts&&clearInterval(portal.bullhornCountIntervalId)})};portal.loggedIn&&portal.bullhorns&&portal.bullhorns.enabled&&(t(),portal.bullhornCountIntervalId=setInterval(t,portal.bullhorns.pollInterval))}}($PBJQ),$PBJQ("#footerAppPresence").on("click",function(){$PBJQ("#presenceArea").toggleClass("is-hidden")}),function(e){if(portal.loggedIn){portal.connectionManager=portal.connectionManager||{};var D=Handlebars.templates["connection-manager-connection"],S=Handlebars.templates["connection-manager-searchresult"],N={},I={},A=function(){return Object.keys(I).length},L={},j={};$PBJQ(document).ready(function(){portal.i18n.loadProperties({resourceClass:"org.sakaiproject.portal.api.PortalService",resourceBundle:"connection-manager",namespace:"connection-manager",callback:function(){portal.i18n.loadProperties({resourceClass:"org.sakaiproject.portal.api.PortalService",resourceBundle:"profile-popup",namespace:"connection-manager"})}})});var F=0,R="connections",q="searchresults",H=R,E=0,O="";portal.connectionManager.show=function(e){var t=$PBJQ("#connection-manager");t.modal({width:320});var a=$PBJQ("#connection-manager-connectionsview"),r=$PBJQ("#connection-manager-searchresultsview"),n=$PBJQ("#connection-manager-searchresultsview-count"),o=$PBJQ("#connection-manager-navbar-current > span > a"),i=$PBJQ("#connection-manager-navbar-pending > span > a"),s=function(e){if(0===e)n.html(portal.i18n.tr("connection-manager","connection_manager_no_results"));else{var t={count:e,criteria:portal.connectionManager.searchCriteria},o=1<e?portal.i18n.tr("connection-manager","connection_manager_results_count",t):portal.i18n.tr("connection-manager","connection_manager_result_count",t);n.html(o)}},l=function(){P.hide(),v.show(),a.show(),r.hide(),o.parent().addClass("current"),i.parent().removeClass("current")},c=function(){v.hide(),P.show(),a.show(),r.hide(),i.parent().addClass("current"),o.parent().removeClass("current")},d=function(e,t){var o=A();$PBJQ("#connection-manager-connection-"+e).remove(),$PBJQ("#connection-manager-connectionsview-searchresult-"+e).remove(),0===p.children().length&&u.hide();var n=L[e];n.connected=!1,n.hideConnect=!0,n.outgoing=!0,I[e]=n;var i=D(n);0===o&&(m.show().html(""),B.hide()),m.append(i),x(),(H===R||H==q&&0===f.children().length)&&c(),$PBJQ("#connection-manager-cancel-button-"+e).click(C)};o.click(function(e){l()}),i.click(function(e){c()});var u=$PBJQ("#connection-manager-connectionsview-searchresults-wrapper"),p=$PBJQ("#connection-manager-connectionsview-searchresults"),f=$PBJQ("#connection-manager-searchresultsview-results");t.click(function(e){if("connection-manager-connectionsview-searchbox"!==e.target.id){var t=u[0].getBoundingClientRect();$[0].getBoundingClientRect();(e.pageX<t.left||e.pageY<t.top||e.pageX>t.left+t.width||e.pageY>t.top+t.height)&&u.hide()}});var h=$PBJQ("#connection-manager-current-connections"),v=$PBJQ("#connection-manager-current-connections-wrapper"),g=$PBJQ("#connection-manager-no-current-connections-wrapper"),m=$PBJQ("#connection-manager-pending-connections"),P=$PBJQ("#connection-manager-pending-connections-wrapper"),B=$PBJQ("#connection-manager-no-pending-connections-wrapper"),$=$PBJQ("#connection-manager-connectionsview-searchbox");$.clearSearch({callback:function(){u.hide()}});var Q=$PBJQ("#connection-manager-searchresultsview-searchbox");0==E&&(O=i.html(),E+=1);var J=function(e){$PBJQ("#connection-manager-connection-"+e).remove(),0==F&&h.html("");var t=I[e];t.outgoing=!1,t.incoming=!1,t.connected=!0;var o=D(t);h.append(o),F+=1,$PBJQ("#connection-manager-remove-button-"+e).click(M),g.hide(),delete I[e],N[e]=t,x(),l()},k=function(){var t=this.dataset.userId,n=this.dataset.displayName;$PBJQ.ajax("/direct/profile/"+portal.user.id+"/confirmFriendRequest?friendId="+t,{cache:!1}).done(function(e){J(t)}).fail(function(e,t,o){console.log("ERROR: failed to confirm request from '"+n+"'. errorThrown: "+o)})},b=function(e){$PBJQ(".connection-manager-connection-"+e).remove(),delete I[e],x()},w=function(){var t=this.dataset.userId,n=this.dataset.displayName;$PBJQ.ajax("/direct/profile/"+portal.user.id+"/ignoreFriendRequest?friendId="+t,{cache:!1}).done(function(e){b(t)}).fail(function(e,t,o){console.log("ERROR: failed to ignore request from '"+n+"'. errorThrown: "+o)})},y=function(){var t=this.dataset.userId,n=this.dataset.displayName;$PBJQ.ajax("/direct/profile/"+portal.user.id+"/requestFriend?friendId="+t,{cache:!1}).done(function(e){d(t)}).fail(function(e,t,o){console.log("ERROR: failed to request connection to '"+n+"'. errorThrown: "+o)})},_=function(e){$PBJQ("#connection-manager-connection-"+e).remove(),0==(F-=1)&&g.show(),delete N[e]},M=function(){var t=this.dataset.userId,n=this.dataset.displayName;confirm(portal.i18n.tr("connection-manager","connection_manager_remove_confirm",{displayName:n}))&&$PBJQ.ajax("/direct/profile/"+portal.user.id+"/removeFriend?friendId="+t,{cache:!1}).done(function(e){_(t)}).fail(function(e,t,o){console.log("ERROR: failed to remove '"+n+"'. errorThrown: "+o)})},C=function(){var t=this.dataset.userId,n=this.dataset.displayName;$PBJQ.ajax("/direct/profile/"+t+"/ignoreFriendRequest?friendId="+portal.user.id,{cache:!1}).done(function(e){$PBJQ(".connection-manager-connection-"+t).remove(),delete I[t],x()}).fail(function(e,t,o){console.log("ERROR: failed to ignore request from '"+n+"'. errorThrown: "+o)})},x=function(){var e=A();0===e?(i.html(O),m.html("").hide(),B.show()):i.html(O+" ("+e+")")},T=function(e,t){var n=t?f:p;if(e.length<4)return n.html(""),void(t?s(0):u.hide());portal.connectionManager.searchCriteria=e;var i=t?D:S;$PBJQ.ajax("/direct/portal/connectionsearch.json?query="+e,{cache:!1}).done(function(e){if(n.html(""),0!==e.length){t||u.show();var o="";L={},(j=e).forEach(function(e){L[e.uuid]=e}),t?j.forEach(function(e,t){o+=i(e)}):j.slice(0,5).forEach(function(e,t){o+=i(e)}),t&&s(j.length),n.html(o),0<n.children().length&&n.show(),$PBJQ(document).ready(function(){t?$PBJQ(".connection-manager-connect-button").click(y):profile.attachPopups($PBJQ(".profile-popup"),{connect:d,cancel:b,accept:J,ignore:b,remove:_}),$PBJQ("#connection-manager-connectionsview-searchresults-more").click(function(e){H=q,p.html(""),u.hide(),a.hide(),r.show(),Q.val(portal.connectionManager.searchCriteria),$.val(""),$PBJQ(document).ready(function(){s(j.length);var o="";j.forEach(function(e,t){e.facebookSet=e.socialNetworkingInfo.facebookUrl,e.twitterSet=e.socialNetworkingInfo.twitterUrl,e.moreResult=!0,N.hasOwnProperty(e.uuid)&&(e.connected=!0,e.hideConnect=!0),I.hasOwnProperty(e.uuid)&&(e.connected=!1,e.hideConnect=!0,e.outgoing=I[e.uuid].outgoing,e.incoming=I[e.uuid].incoming),o+=D(e)}),f.html(o),$PBJQ(document).ready(function(){$PBJQ(".connection-manager-accept-button").click(k),$PBJQ(".connection-manager-ignore-button").click(w),$PBJQ(".connection-manager-connect-button").click(y),$PBJQ(".connection-manager-remove-button").click(M),$PBJQ(".connection-manager-cancel-button").click(C)})})}),$PBJQ("#connection-manager-backtoconnections-link").click(function(e){H=R,r.hide(),a.show(),u.hide(),p.html(""),$.val("")})})}else t||u.hide()})};$PBJQ.ajax("/direct/profile/"+portal.user.id+"/connections.json",{cache:!1}).done(function(e){N={},F=e.length,searchUserIdFilter=[portal.user.id],h.html(""),0==e.length?g.show():g.hide(),e.forEach(function(e){e.facebookSet=e.socialNetworkingInfo.facebookUrl,e.twitterSet=e.socialNetworkingInfo.twitterUrl,e.current=!0,e.connected=!0,e.incoming=!1,e.hideConnect=!0,N[e.uuid]=e,h.append(D(e))}),$PBJQ(document).ready(function(){$PBJQ(".connection-manager-remove-button").click(M)})}).fail(function(e,t,o){console.log("ERROR: failed to get current connections. errorThrown: "+o)});$PBJQ.ajax("/direct/profile/"+portal.user.id+"/incomingConnectionRequests.json",{cache:!1}).done(function(o){I={},o.forEach(function(e){e.incoming=!0}),$PBJQ.ajax("/direct/profile/"+portal.user.id+"/outgoingConnectionRequests.json",{cache:!1}).done(function(e){var t;e.forEach(function(e){e.outgoing=!0,o.push(e)}),0==(t=o).length?(B.show(),m.hide()):(B.hide(),m.show().html("")),t.forEach(function(e){e.hideConnect=!0,e.pending=!0,m.append(D(e)),I[e.uuid]=e}),0<t.length?i.html(O+" ("+t.length+")"):i.html(O),$PBJQ(document).ready(function(){$PBJQ(".connection-manager-accept-button").click(k),$PBJQ(".connection-manager-ignore-button").click(w),$PBJQ(".connection-manager-cancel-button").click(C)})}).fail(function(e,t,o){console.log("Failed to get outgoing requests. errorThrown: "+o)})}).fail(function(e,t,o){console.log("Failed to get incoming requests. errorThrown: "+o)}),$.keyup(function(e){T(this.value,!1)}),$.keydown(function(e){13==e.which&&4<=this.value.length&&$PBJQ("#connection-manager-connectionsview-searchresults-more").click()}),Q.keyup(function(e){T(this.value,!0)}),e&&"pending"===e.state&&c()},$PBJQ("#Mrphs-userNav__submenuitem--connections").click(portal.connectionManager.show)}}($PBJQ),$PBJQ(document).ready(function(){updateFooterTime=function(){if(1==$PBJQ("#preferredTime").length)var t=$PBJQ("#preferredTime").data("preferredtzdisplay"),o=new Date(parseInt($PBJQ("#preferredTime").data("preferredserverdateandgmtoffset"))).getTime()-(new Date).getTime();var n=$PBJQ("#serverTime").data("servertzdisplay"),i=new Date(parseInt($PBJQ("#serverTime").data("serverdateandgmtoffset"))).getTime()-(new Date).getTime();return function(){var e=new Date((new Date).getTime()+i).toUTCString().replace(/GMT/,n).replace(/UTC/,n);if($PBJQ("#serverTime").text(e),1==$PBJQ("#preferredTime").length){e=new Date((new Date).getTime()+o).toUTCString().replace(/GMT/,t).replace(/UTC/,t);$PBJQ("#preferredTime").text(e)}setTimeout("updateFooterTime()",1e3)}}(),1==$PBJQ("#serverTime").length&&updateFooterTime(),$PBJQ("#Mrphs-footer--details__info").click(function(e){toggleFooterDetailsPanel(e)}),$PBJQ("#Mrphs-footer--details__close").click(function(e){toggleFooterDetailsPanel(e)})}),$PBJQ,portal.loggedIn&&(portal.i18n=portal.i18n||{},portal.i18n.translations=portal.i18n.translations||{},portal.i18n.loadProperties=function(n){n.resourceClass&&n.resourceBundle&&n.namespace?(n.debug&&(console.log("resourceClass: "+n.resourceClass),console.log("resourceBundle: "+n.resourceBundle),console.log("namespace: "+n.namespace)),portal.i18n.translations[n.namespace]=portal.i18n.translations[n.namespace]||{},$PBJQ.ajax({url:"/sakai-ws/rest/i18n/getI18nProperties",cache:!0,dataType:"text",data:{locale:portal.locale,resourceclass:n.resourceClass,resourcebundle:n.resourceBundle}}).done(function(e,t,o){e.split("\n").forEach(function(e){var t=e.split("=");2==t.length&&(portal.i18n.translations[n.namespace][t[0]]=t[1]),n.debug&&(console.log("Updated translations: "),console.log(portal.i18n.translations[n.namespace]))}),n.callback&&n.callback()}).fail(function(e,t,o){console.log(o)})):console.log("You must supply a resourceClass, a resourceBundle and a namespace. Doing nothing ...")},portal.i18n.tr=function(e,t,o){if(e&&t){var n=portal.i18n.translations[e][t];if(!n)return console.log(e+"#key "+t+" not found. Returning key ..."),t;if(null!=o)for(var i in o)n=n.replace("{"+i+"}",o[i]);return n}console.log("You must supply a namespace and a key.")},Handlebars.registerHelper("tr",function(e,t,o){return new Handlebars.SafeString(portal.i18n.tr(e,t,o.hash))})),$PBJQ(document).ready(function(){var n={dragModeStartMsg:"drag start, Use U and D keys to move the item up and down",dragModeEndMsg:"Drag end",newPositionMsg:"Moved to position %s"};$PBJQ.widget("sakai.keyboardSortable",$PBJQ.ui.sortable,{options:{keyboardHandle:!1},_create:function(){this._super(),this.options.keyboardHandle=this.options.keyboardHandle||this.options.items,this._dragging=!1,this.element.on("keydown",this.options.keyboardHandle,$PBJQ.proxy(this._keydown,this)),this.liveRegion=$PBJQ("<div class='ui-helper-hidden-accessible'></div>").liveregion().appendTo(document.body),this.element.find(this.options.keyboardHandle).attr({"aria-grabbed":"false","data-at-shortcutkeys":'{"u":"drag item up","d":"drag item down"}'}).blur($PBJQ.proxy(function(e){var t=$PBJQ(e.target);this._isDragging()&&this._toggleDragMode(t,this._closestSortableNode(t))},this)).click($PBJQ.proxy(function(e){if(e.clientX<=0||void 0===e.clientX){var t=$PBJQ(e.target);this._toggleDragMode(t,this._closestSortableNode(t))}},this))},_keydown:function(e){if(-1!==$PBJQ.inArray(e.which,[27,38,40,68,85])&&!$PBJQ(e.target).is(":input")){e.preventDefault();var t=$PBJQ(e.target),o=this._closestSortableNode(t);switch(e.which){case 27:this._isDragging()&&this._toggleDragMode(t,o);break;case 38:case 85:(e.ctrlKey||this._isDragging()||85===e.which)&&this._moveBackward(o,t);break;case 40:case 68:(e.ctrlKey||this._isDragging()||68===e.which)&&this._moveForward(o,t)}}},_closestSortableNode:function(e){var t=e.parentsUntil(this.element).last();return t.length||(t=e),t},_isDragging:function(){return this._dragging},_toggleDragMode:function(e,t){var o=this._isDragging();t.toggleClass("sakai-dragging",!o),o?(e.attr("aria-grabbed","false"),this._dragging=!1,this._notify(n.dragModeEndMsg)):(this.element.find(this.options.keyboardHandle).attr("aria-grabbed","false"),this._dragging=!0,e.attr("aria-grabbed","true"),this._notify(n.dragModeStartMsg))},_moveBackward:function(e,t,o){$prevNode=e.prev(o),$prevNode.length&&($prevNode.insertAfter(e),this._highlightDrag(e),this._notifyPosition(e))},_moveForward:function(e,t,o){$nextNode=e.next(o),$nextNode.length&&($nextNode.insertBefore(e),this._highlightDrag(e),this._notifyPosition(e))},_highlightDrag:function(e){this._isDragging()||(e.addClass("sakai-dragging-temp"),setTimeout(function(){e.removeClass("sakai-dragging-temp")},1e3))},_notifyPosition:function(e){var t=this.element.find(this.options.items).index(e)+1;this._notify(n.newPositionMsg.replace("%s",t))},_notify:function(e){this.liveRegion.liveregion("instance").notify(e),this._trigger("update")}}),$PBJQ.widget("sakai.liveregion",{_create:function(){this.timeout=null},notify:function(t){setTimeout($PBJQ.proxy(function(){var e=$PBJQ("<div aria-live='polite'></div>").attr("role","status").appendTo(this.element);this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout($PBJQ.proxy(function(){e.text(t)},this),500),setTimeout($PBJQ.proxy(function(){this._clear(e)},this),1e4)},this),0)},_clear:function(e){e.remove()}})});var dhtml_view_sites=function(){$PBJQ("#selectSiteModal").addClass("dhtml_more_tabs"),$PBJQ(".more-tab").position();var a=.8*$PBJQ(window).height();dhtml_view_sites=function(){var e=$PBJQ("#selectSiteModal");if(e.show(),void 0!==selectSiteModalLinks&&void 0!==selectSiteLastModalInTab||(selectSiteModalLinks=e.find("button, a"),selectSiteLastModalInTab=e.find(".tab-box a:last")),e.on("keydown",function(e){var t=!1;if(!(e.ctrlKey||e.metaKey||e.altKey)){switch(e.which){case 27:closeDrawer(),t=!0;break;case 9:e.shiftKey?e.target===selectSiteModalLinks[0]&&(selectSiteModalLinks[selectSiteModalLinks.length-1].focus(),t=!0):e.target!==selectSiteModalLinks[selectSiteModalLinks.length-1]&&e.target!==selectSiteLastModalInTab[selectSiteLastModalInTab.length-1]||(selectSiteModalLinks[0].focus(),t=!0)}t&&e.preventDefault()}}),e.hasClass("outscreen")){$PBJQ("body").toggleClass("active-more-sites");var t=(i=$PBJQ(".view-all-sites-btn:visible")).height()+5;if(0<i.length){i.css("z-index",1005);var o=i.offset().top-$PBJQ(window).scrollTop()+t,n=$PBJQ("body").outerWidth()-(i.offset().left+i.outerWidth());"rtl"!==$PBJQ("html").attr("dir")?e.css("top",o).css("right",n):e.css("top",o).css("left",$PBJQ("body").outerWidth()-n)}e.toggleClass("outscreen"),a-=o,a-=parseInt(e.css("padding-bottom"),20),MorpheusViewportHelper.isNonPhone()&&$PBJQ("#txtSearch").focus(),createDHTMLMask(dhtml_view_sites),$PBJQ(".selectedTab").bind("click",function(e){return dhtml_view_sites(),!1}),$PBJQ(".tab-pane:first").focus(),$PBJQ(document).trigger("view-sites-shown")}else{var i;$PBJQ("body").toggleClass("active-more-sites"),$PBJQ("#selectSiteModal").toggleClass("outscreen"),(i=$PBJQ(".view-all-sites-btn")).css("z-index","auto"),$PBJQ("#selectSite").attr("tabindex","-1"),removeDHTMLMask(),$PBJQ("#otherSiteTools").remove(),$PBJQ(".selectedTab").unbind("click")}},$PBJQ(window).width()<800&&(a*=.85),$PBJQ(".tab-pane").css("height",a),dhtml_view_sites()};function closeDrawer(){$PBJQ("#selectSiteModal").toggleClass("outscreen"),removeDHTMLMask(),$PBJQ("#selectSite").attr("tabindex","-1"),$PBJQ("#otherSiteTools").remove(),$PBJQ(".selectedTab").unbind("click"),$PBJQ(".moreSitesLink").unbind("keydown"),$PBJQ(".view-all-sites-btn a:visible").length?$PBJQ(".view-all-sites-btn a").focus():$PBJQ(".js-toggle-sites-nav").focus()}function createDHTMLMask(t){$PBJQ("body").append('<div id="portalMask">&nbsp;</div>'),$PBJQ("#portalMask").css("height",browserSafeDocHeight()).css({width:"100%","z-index":1e3,top:0,left:0}).attr("tabindex",-1).bind("click",function(e){return t(),!1}),$PBJQ("#portalMask").bgiframe()}function removeDHTMLMask(){$PBJQ("#portalMask").remove()}function showToolMenu(t){var e=t.attr("id"),o=e.replace(/!/g,"\\!").replace(/~/g,"\\~");if($PBJQ(".toolMenus").removeClass("toolMenusActive").attr("aria-expanded","false"),$PBJQ("."+o).length)$PBJQ("#otherSiteTools").remove();else{var n=$PBJQ('<ul id="otherSiteTools" role="menu" />').addClass(e),i="/direct/site/"+e+"/pages.json";scroll(0,0);var a=parseInt($PBJQ("#maxToolsInt").text()),r=$PBJQ("#maxToolsText").text(),s=$PBJQ('<li class="otherSiteTool" ><span><a role="menuitem" tabindex="-1"><span class="Mrphs-toolsNav__menuitem--icon"> </span></a></span></li>'),l=s.clone();l.addClass("gotosite"),l.find("a").attr("href",portal.portalPath+"/site/"+e).attr("title",r).append(r),l.find("a span").addClass("icon-sakai--see-all-tools"),$PBJQ.getJSON(i,function(e){$PBJQ.each(e,function(e,t){if(!t.tools[0])return!0;if(e<a){var o=s.clone();o.find("a").attr("href",t.tools[0].url).attr("title",t.title).append(t.title),o.find("a span").addClass("icon-sakai--"+t.tools[0].toolId.replace(/\./gi,"-")).addClass("otherSiteToolIcon"),t.toolpopup&&o.find("a").attr("href",t.tools[0].url+"?sakai.popup=yes").attr("onclick","window.open("+t.toolpopupurl+"); return false"),n.append(o)}}),e.length>a&&n.append(l.clone()),$PBJQ("#otherSiteTools").remove(),t.closest("li").append(n),t.closest("li").find("ul li a").first().focus(),addArrowNavAndDisableTabNav($PBJQ("ul#otherSiteTools")),t.parent().find(".toolMenus").addClass("toolMenusActive").attr("aria-expanded","true")})}}$PBJQ(document).ready(function(){1===$PBJQ("#eid").length&&$PBJQ("#eid").focus(),$PBJQ(".js-toggle-sites-nav","#skipNav").on("click",dhtml_view_sites),$PBJQ("#show-all-sites, .view-all-sites-btn").on("click",dhtml_view_sites);var e=portal.siteTitle;function n(){$PBJQ("#txtSearch").val(""),$PBJQ(".fav-sites-term, .fav-sites-entry").show(),$PBJQ("#noSearchResults").hide(),$PBJQ("#txtSearch").focus()}e&&(portal.shortDescription&&(e=e+" ("+portal.shortDescription+")"),$PBJQ(".portletTitle h2").prepend('<span class="siteTitle">'+e+":</span> ")),$PBJQ("#txtSearch").keyup(function(e){if(27==e.keyCode&&n(),0<$PBJQ("#txtSearch").val().length){var o=$PBJQ("#txtSearch").val().toLowerCase();$PBJQ(".fav-sites-term, .fav-sites-entry").hide();var t=$PBJQ(".fav-sites-entry").filter(function(e,t){return 0<=$PBJQ(".fav-title a span.fullTitle",t).text().toLowerCase().indexOf(o)});t.show(),t.closest(".fav-sites-term").show()}0==$PBJQ("#txtSearch").val().length&&n(),$PBJQ("#otherSiteList li:visible").length<1&&$PBJQ(".otherSitesCategorList li:visible").length<1&&($PBJQ(".norecords").remove(),$PBJQ("#noSearchResults").fadeIn("slow"))}),$PBJQ("#otherSiteSearchClear").on("click",function(){n()}),$PBJQ("#presenceToggle").click(function(e){e.preventDefault(),$PBJQ("#presenceArea").toggle()}),$PBJQ(".trayPopupClose").click(function(e){e.preventDefault(),$PBJQ(this).closest(".trayPopup").hide()}),$PBJQ("a.tool-directurl").length&&$PBJQ("a.tool-directurl").cluetip({local:!0,arrows:!0,cluetipClass:"jtip",sticky:!0,cursor:"pointer",activation:"click",closePosition:"title",closeText:'<img src="/library/image/silk/cross.png" alt="close">'})}),$PBJQ(document).ready(function(e){var a=!0,r=void 0,s=[],n=$PBJQ("#max-favorite-entries").text().trim(),i=!1,t=$PBJQ("#selectSite"),l=$PBJQ("#otherSitesCategorWrap"),o=$PBJQ("#organizeFavorites"),c={};$PBJQ(".site-favorite-btn",l).each(function(e,t){c[$PBJQ(t).attr("data-site-id")]=$PBJQ(t).parent()});var d={favorite:{markup:'<i class="site-favorite-icon site-favorite"></i>'},nonfavorite:{markup:'<i class="site-favorite-icon site-nonfavorite"></i>'},myworkspace:{markup:'<i class="site-favorite-icon site-workspace site-favorite"></i>'}},u=function(e,t){var o=d[t];$PBJQ(e).data("favorite-state",t),"favorite"===t?$PBJQ(e).attr("title",$PBJQ("#removeFromFavoritesText").text().replace("[site]",$PBJQ(e).parent().find("span.fullTitle").text())):"nonfavorite"===t?$PBJQ(e).attr("title",$PBJQ("#addToFavoritesText").text().replace("[site]",$PBJQ(e).parent().find("span.fullTitle").text())):$PBJQ(e).attr("title",null),$PBJQ(e).empty().append($PBJQ(o.markup))},p=function(){var e=$PBJQ(".fav-sites-entry .site-favorite",l).length;$PBJQ(".favoriteCount",t).text("("+e+")"),n<e?$PBJQ(".favoriteCountAndWarning").addClass("maxFavoritesReached"):$PBJQ(".favoriteCountAndWarning").removeClass("maxFavoritesReached")},f=function(){$PBJQ(".favorites-select-all-none",l).each(function(e,t){var o=$PBJQ(t).closest(".fav-sites-term"),n=o.find(".fav-sites-entry:not(.my-workspace)").length,i=o.find(".fav-sites-entry .site-favorite").length;0==n?$PBJQ(t).hide():(i==n?($PBJQ(t).data("favorite-state","favorite"),$PBJQ(t).html(d.favorite.markup)):($PBJQ(t).data("favorite-state","nonfavorite"),$PBJQ(t).html(d.nonfavorite.markup)),$PBJQ(t).show())})},h=function(n){$PBJQ(".site-favorite-btn",l).each(function(e,t){var o=$PBJQ(t).attr("data-site-id");0<$PBJQ(t).closest(".my-workspace").length?u(t,"myworkspace"):0<=$PBJQ.inArray(o,n)?u(t,"favorite"):u(t,"nonfavorite")}),$PBJQ(".favorites-help-text").hide(),a?$PBJQ(".favorites-help-text.autofavorite-enabled").show():$PBJQ(".favorites-help-text.autofavorite-disabled").show(),f(),p(),i=!0},v=function(e){var t;g&&(i=!1,$PBJQ(".site-favorite-btn",l).empty(),$PBJQ(".favorites-select-all-none",l).empty()),e||(e=0),g&&e<100?setTimeout(function(){v(e+1)},50):(t=h,$PBJQ.ajax({url:"/portal/favorites/list",method:"GET",dataType:"json",success:function(e){a=e.autoFavoritesEnabled,s=e.favoriteSiteIds.filter(function(e,t){return""!=e}),null==r&&(r=s),t(s)}}))},g=!1,m=[],P=function(e){for(var t;0<m.length;)t=m.shift();t?$PBJQ.ajax({url:"/portal/favorites/update",method:"POST",data:{userFavorites:JSON.stringify(t)},error:e,complete:P}):g=!1},B=function(e){if(i){e||(e=function(){});var t=$PBJQ(".site-favorite-btn",l).has(".site-favorite").map(function(){return $PBJQ(this).attr("data-site-id")}).toArray(),o={favoriteSiteIds:t=t.sort(function(e,t){return-1===s.indexOf(e)?1:-1===s.indexOf(t)?-1:s.indexOf(e)-s.indexOf(t)}),autoFavoritesEnabled:a};m.push(o),g||(g=!0,P(e)),s=t,function(){if(function(e,t){if(e.length!=t.length)return!1;for(var o=0;o<e.length;o++)if(e[o]!=t[o])return!1;return!0}(s,r))$PBJQ(".moresites-refresh-notification").remove();else if(!(0<$PBJQ(".moresites-refresh-notification").length)){var e=$PBJQ('<div class="moresites-refresh-notification" />').html($PBJQ("#refreshNotificationText").html());$PBJQ("#loginLinks").prepend(e),e.css("top",$PBJQ(".Mrphs-siteHierarchy").offset().top+"px")}}()}},$=function(e){if(r&&-1<r.indexOf(e)){for(var t=r.indexOf(e),o=!1,n=t-1;0<=n;n--){var i=r[n],a=s.indexOf(i);if(0<=a&&a<t){s.splice(a+1,0,e),o=!0;break}}o||s.splice(t,0,e)}};$PBJQ(l).on("click",".site-favorite-btn",function(){var e,t=$PBJQ(this).attr("data-site-id"),o=$PBJQ(this).data("favorite-state");"myworkspace"!==o&&("favorite"==(e="favorite"===o?"nonfavorite":"favorite")&&$(t),u(this,e),f(),p(),B(function(){v()}))}),$PBJQ(l).on("click",".favorites-select-all-none",function(){var o,e=$PBJQ(this).data("favorite-state"),t=$PBJQ(this).closest(".fav-sites-term").find(".fav-sites-entry:not(.my-workspace) .site-favorite-btn");o="favorite"==e?"nonfavorite":"favorite",t.each(function(e,t){u($PBJQ(t),o)}),p(),f(),B(function(){v()})}),$PBJQ(t).on("click",".tab-btn",function(){$PBJQ(".tab-btn",t).removeClass("active").attr("aria-selected","false").attr("tabindex","-1"),$PBJQ(this).addClass("active").attr("aria-selected","true").attr("tabindex","0");var e=$PBJQ(this).data("tab-target");$PBJQ(".tab-box").hide(),$PBJQ(t).trigger("tab-shown",e),$PBJQ("#"+e).show()}),$PBJQ(t).on("keydown",".tab-btn",function(e){32==e.keyCode&&($PBJQ(this).click(),e.preventDefault()),37==e.keyCode&&($PBJQ("[aria-selected=true]").prev().click().focus(),e.preventDefault()),38==e.keyCode&&($PBJQ("[aria-selected=true]").prev().click().focus(),e.preventDefault()),39==e.keyCode&&($PBJQ("[aria-selected=true]").next().click().focus(),e.preventDefault()),40==e.keyCode&&($PBJQ("[aria-selected=true]").next().click().focus(),e.preventDefault())}),$PBJQ(document).on("view-sites-shown",function(){v()}),$PBJQ(t).on("tab-shown",function(e,t){if("organizeFavorites"===t){var i=$PBJQ("#organizeFavoritesList");i.empty(),$PBJQ("#noFavoritesToShow").hide(),$PBJQ("#favoritesToShow").hide(),$PBJQ("#otherSiteTools").remove(),$PBJQ("#organizeFavoritesPurgatoryList").empty(),$PBJQ.each(s,function(e,t){if(c[t]&&!$PBJQ(c[t]).hasClass("my-workspace")){var o=c[t].clone(!1);o.addClass("organize-favorite-item").data("site-id",t);var n=$PBJQ('<a href="javascript:void(0);" class="fav-drag-handle"><i class="fa fa-bars"></i></a>');$PBJQ(".toolMenus",o).remove(),o.append(n),i.append(o),o.show()}}),0==i.find("li").length?$PBJQ("#noFavoritesToShow").show():$PBJQ("#favoritesToShow").show();var o=function(){var e=$PBJQ(".organize-favorite-item");e.removeClass("site-favorite-is-past-max"),$PBJQ(".favorites-max-marker").remove(),$PBJQ.each(e,function(e,t){n<=e&&$PBJQ(t).addClass("site-favorite-is-past-max"),e==n&&$PBJQ(t).before($PBJQ('<li class="favorites-max-marker"><i class="fa fa-warning warning-icon"></i> '+$PBJQ("#maxFavoritesLimitReachedText").text()+"</li>"))})};o(),i.keyboardSortable({items:"li:not(.favorites-max-marker)",handle:".fav-drag-handle",update:function(){o(),s=i.find(".organize-favorite-item *[data-site-id]").map(function(){return $PBJQ(this).attr("data-site-id")}).toArray(),B()}}),i.disableSelection(),$PBJQ("#autoFavoritesEnabled").attr("aria-checked",a),$PBJQ("#organizeFavorites .onoffswitch").show()}}),$PBJQ(l).on("click",".toolMenus",function(e){return e.preventDefault(),showToolMenu($PBJQ(this)),!1}),$PBJQ(o).on("click",".site-favorite-btn",function(){var e=this;if(!(0<$PBJQ(e).closest(".my-workspace").length)){var t,o=$PBJQ(e).parent();if(0==$PBJQ(e).closest("#organizeFavoritesList").length){var n=$PBJQ(e).attr("data-site-id");$(n);var i=s.indexOf(n);0==i?$PBJQ("#organizeFavoritesList").prepend(o):0<i?$PBJQ("#organizeFavoritesList li:nth-child("+i+")").after(o):$PBJQ("#organizeFavoritesList").append(o),t="favorite"}else $PBJQ("#organizeFavoritesPurgatoryList").append(o),t="nonfavorite";u(e,t),u(c[$PBJQ(e).attr("data-site-id")].find(".site-favorite-btn"),t),f(),p(),B(function(){v()})}}),$PBJQ("#autoFavoritesEnabled").click(function(){$PBJQ(this).attr("aria-checked",function(e,t){return String(!("true"===t))}),$PBJQ(this).trigger("change")}),$PBJQ("#autoFavoritesEnabled").on("change",function(){return a="true"===$PBJQ(this).attr("aria-checked"),$PBJQ(".favorites-help-text").hide(),a?$PBJQ(".favorites-help-text.autofavorite-enabled").show():$PBJQ(".favorites-help-text.autofavorite-disabled").show(),B(),!0}),$PBJQ(".otherSitesMenuClose").on("click",function(){dhtml_view_sites()})});var profile=profile||{};function publishSite(e){var t="/direct/site/"+e+"/edit";$PBJQ.ajax({type:"POST",data:"published=true",url:t,success:function(){location.reload()}}).responseText}function quickLinksNavEscHandler(e){27===e.keyCode&&toggleQuickLinksNav(e)}function toggleQuickLinksNav(e){if(e.preventDefault(),$PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden")||toggleUserNav(e),$PBJQ(".Mrphs-quickLinksNav__subnav").toggleClass("is-hidden"),$PBJQ(".Mrphs-quickLinksNav__subnav").hasClass("is-hidden"))$PBJQ(".quicklinks-dropdown-overlay").remove(),$PBJQ("body").css("overflow-y","visible"),$PBJQ(document).off("keyup",quickLinksNavEscHandler);else{var t=$PBJQ('<div class="quicklinks-dropdown-overlay" />');t.on("click",function(e){toggleQuickLinksNav(e)}),$PBJQ("body").prepend(t),$PBJQ("body").css("overflow-y","hidden"),$PBJQ(document).on("keyup",quickLinksNavEscHandler),$PBJQ(".tab-box").css("max-height",window.innerHeight-$PBJQ("#selectQuickLink").offset().top-14)}}profile.requestFriend=function(e,n,i){return $PBJQ.ajax({url:"/direct/profile/"+e+"/requestFriend?friendId="+n,dataType:"text",cache:!1}).done(function(e,t,o){$PBJQ("#profile-popup-request-button-"+n).hide(),$PBJQ("#profile-popup-cancel-button-"+n).show(),i&&i(n)}),!1},profile.confirmFriendRequest=function(e,n,i){return $PBJQ.ajax({url:"/direct/profile/"+e+"/confirmFriendRequest?friendId="+n,dataType:"text",cache:!1}).done(function(e,t,o){$PBJQ("#profile-popup-incoming-block-"+n).hide(),$PBJQ("#profile-popup-remove-button-"+n).show(),i&&i(n)}),!1},profile.removeFriend=function(e,n,i,a){return $PBJQ.ajax({url:"/direct/profile/"+e+"/removeFriend?friendId="+n,dataType:"text",cache:!1}).done(function(e,t,o){$PBJQ("#profile-popup-remove-button-"+n).hide(),$PBJQ("#profile-popup-request-button-"+n).show(),i&&a&&i(n,a)}),!1},profile.ignoreFriendRequest=function(n,i,a,r){return $PBJQ.ajax({url:"/direct/profile/"+n+"/ignoreFriendRequest?friendId="+i,cache:!1}).done(function(e,t,o){void 0!==a&&1==a?($PBJQ("#profile-popup-cancel-button-"+n).hide(),$PBJQ("#profile-popup-request-button-"+n).show(),r&&r(n)):($PBJQ("#profile-popup-incoming-block-"+i).hide(),$PBJQ("#profile-popup-request-button-"+i).show(),r&&r(i))}),!1},profile.attachPopups=function(e,c){e instanceof $PBJQ?e.each(function(){var s=this.dataset.userId,l=this.dataset.displayName,e=$PBJQ(this).find(".profile-popup-target"),t=0<e.length?e.eq(0):$PBJQ(this);$PBJQ(this).qtip({position:{target:t,my:"top left",at:"bottom center",viewport:$PBJQ(window),adjust:{method:"flipinvert none"}},show:{event:"click",delay:0},style:{classes:"profile-popup-qtip qtip-shadow"},hide:{event:"click unfocus"},content:{text:function(e,n){return $PBJQ.ajax({url:"/direct/portal/"+s+"/formatted",cache:!1}).then(function(e){return e},function(e,t,o){n.set("content.text",t+": "+o)})}},events:{visible:function(e,o){var t=$PBJQ("#profile-popup-request-button-"+s);t.on("click",function(e){profile.requestFriend(portal.user.id,s)});var n=$PBJQ("#profile-popup-cancel-button-"+s);n.on("click",function(e){profile.ignoreFriendRequest(s,portal.user.id,!0)});var i=$PBJQ("#profile-popup-accept-button-"+s);i.on("click",function(e){profile.confirmFriendRequest(portal.user.id,s)});var a=$PBJQ("#profile-popup-ignore-button-"+s);a.on("click",function(e){profile.ignoreFriendRequest(portal.user.id,s,!1)});var r=$PBJQ("#profile-popup-remove-button-"+s);r.on("click",function(e){profile.removeFriend(portal.user.id,s)}),c&&(c.connect&&t.off("click").on("click",function(e){profile.requestFriend(portal.user.id,s,function(e){c.connect(e),o.destroy()})}),c.cancel&&n.off("click").on("click",function(e){profile.ignoreFriendRequest(s,portal.user.id,!0,function(e){c.cancel(e),o.destroy()})}),c.accept&&i.off("click").on("click",function(e){profile.confirmFriendRequest(portal.user.id,s,function(e){c.accept(e),o.destroy()})}),c.ignore&&a.off("click").on("click",function(e){profile.ignoreFriendRequest(portal.user.id,s,!1,function(e){c.ignore(e),o.destroy()})}),c.remove&&r.off("click").on("click",function(e){profile.removeFriend(portal.user.id,s,function(e,t){c.remove(e,t),o.destroy()},l)}))}}})}):console.log("profile.attachPopups takes a jQuery object array, from a selector")},$PBJQ("#quickLinks-close").on("click",toggleQuickLinksNav),$PBJQ(".js-toggle-quick-links-nav").on("click",toggleQuickLinksNav),$PBJQ(document).ready(function(){return 15<$PBJQ("#reorder-list li").size()-1&&($PBJQ(".grabHandle").show(),$PBJQ("#inputFieldMessage").show(),$PBJQ("#inputKbdMessage").remove()),$PBJQ("#reorder-list li").each(function(e){$PBJQ("#lastMoveArrayInit").append($PBJQ(this).attr("id")+" "),$PBJQ("#lastMoveArray").append($PBJQ(this).attr("id")+" ")}),$PBJQ('input[id^="index"]').click(function(e){e.stopPropagation()}),$PBJQ('input[id^="index"]').bind("keypress",function(e){return 13!=(e.charCode||e.keyCode)}),$PBJQ("#undo-all").click(function(e){var t;for(z in t=$PBJQ.trim($PBJQ("#lastMoveArrayInit").text()).split(" "))thisRow=document.getElementById(t[z]),$PBJQ(thisRow).appendTo("#reorder-list");e.preventDefault(),registerChange(),$PBJQ("#undo-all").hide(),$PBJQ("#undo-all-inact").show(),$PBJQ("#undo-last-inact").show(),$PBJQ("#undo-last").hide()}),$PBJQ("#undo-last").click(function(e){var t,o,n;for(z in t=$PBJQ.trim($PBJQ("#lastMoveArray").text()).split(" "))thisRow=document.getElementById(t[z]),$PBJQ(thisRow).appendTo("#reorder-list");o=$PBJQ.trim($PBJQ("#lastItemMoved").text()),n=$PBJQ("li:eq("+o.substr(20)+")"),$PBJQ(n).addClass("recentMove"),e.preventDefault(),registerChange("notfluid",n),$PBJQ("#undo-last-inact").fadeIn("slow"),$PBJQ("#undo-last").hide()}),$PBJQ('input[id^="index"]').change(function(){var e=this;preserveStatus();var t=parseInt($PBJQ(this).siblings('input[id^="holder"]').attr("value")),o=parseInt(this.value);if(isNaN(o)||o>$PBJQ('input[id^="index"]').size()){var n=$PBJQ("#failedValidMessage").text();$PBJQ("#messageHolder").text(n.replace("#",$PBJQ('input[id^="index"]').size())),$PBJQ(".orderable-selected").removeClass("orderable-selected"),$PBJQ("#messageHolder").removeClass("messageSuccess"),$PBJQ("#messageHolder").addClass("messageValidation");var i=$PBJQ(e).position();return $PBJQ("#messageHolder").css({position:"absolute",height:"1.3em",top:i.top,left:55}),$PBJQ("#messageHolder").fadeIn("slow"),$PBJQ("#messageHolder").animate({opacity:1},2e3,function(){$PBJQ(e).val(t),e.focus(),e.select()}),$PBJQ("#messageHolder").fadeOut("slow"),$PBJQ(this).parents("li").addClass("orderable-selected"),null}var a=$PBJQ('input[id^="index"]');$PBJQ("#undo-last").fadeIn("slow"),$PBJQ("#undo-last-inact").hide(),$PBJQ("#undo-all").fadeIn("slow"),$PBJQ("#undo-all-inact").hide(),"1"===o?$PBJQ($PBJQ(this).parents("li")).insertBefore($PBJQ(this).parents("li").siblings("li").children("span").children("input[value="+o+"]").parents("li")):o==a.length?$PBJQ($PBJQ(this).parents("li")).insertAfter($PBJQ(this).parents("li").siblings("li").children("span").children("input[value="+o+"]").parents("li")):t<o?$PBJQ($PBJQ(this).parents("li")).insertAfter($PBJQ(this).parents("li").siblings("li").children("span").children("input[value="+o+"]").parents("li")):$PBJQ($PBJQ(this).parents("li")).insertBefore($PBJQ(this).parents("li").siblings("li").children("span").children("input[value="+o+"]").parents("li")),registerChange("notfluid",$PBJQ(this).parents("li"))}),$PBJQ("#reorder-list").keyboardSortable({items:"li:not(.notsortable)",start:function(e,t){preserveStatus(t)},update:function(e,t){registerChange(e,t)}})});var registerChange=function(e,t){$PBJQ("#reorder-list li").size();"notfluid"!==e&&(t=$PBJQ("li[aria-selected='true']")),$PBJQ("#lastItemMoved").text($PBJQ(t).attr("id")),$PBJQ(t).addClass("recentMove");$PBJQ(t.prevAll("li").length+1);for(var o=$PBJQ('input[id^="index"]'),n=$PBJQ('input[id^="holder"]'),i=$PBJQ("select.selectSet"),a=0;a<o.length;a+=1)$PBJQ(o[a]).attr("value",a+1).val(a+1);for(var r=0;r<n.length;r+=1)$PBJQ(n[r]).attr("value",r+1).val(r+1);for(var s=0;s<i.length;s+=1)$PBJQ(i[s]).val(s+1),$PBJQ(i[s]).find("option").removeAttr("selected"),$PBJQ(i[s]).find("option[value="+(s+1)+"]").attr("selected","selected");$PBJQ("#undo-last").fadeIn("slow"),$PBJQ("#undo-last-inact").hide(),$PBJQ("#undo-all").fadeIn("slow"),$PBJQ("#undo-all-inact").hide(),$PBJQ(t).animate({opacity:1},2e3,function(){$PBJQ(t).removeClass("recentMove")})},preserveStatus=function(e){$PBJQ("#lastMoveArray").text(""),$PBJQ("#reorder-list li").each(function(e){void 0!==$PBJQ(this).attr("id")&&"undefined_avatar"!==$PBJQ(this).attr("id")&&$PBJQ("#lastMoveArray").append($PBJQ(this).attr("id")+" ")})};function toggleToolsNav(e){e&&e.preventDefault(),$PBJQ("body").toggleClass("toolsNav--displayed"),$PBJQ("body").hasClass("toolsNav--displayed")?createDHTMLMask(toggleToolsNav):removeDHTMLMask()}$PBJQ(document).ready(function(){$PBJQ("#roleSwitchSelect").on("change",function(){""!==$PBJQ("option:selected",this).text()?document.location=$PBJQ("option:selected",this).val()+"#roleSwitch":$PBJQ(this)[0].selectedIndex=0}),MorpheusViewportHelper.isPhone()?function(){function t(){$PBJQ("#roleSwitchDropDown").is(".open")&&$PBJQ("#roleSwitchDropDownToggle").trigger("click")}function e(e){return 27!=e.keyCode||(t(),!1)}$PBJQ("#roleSwitchDropDownToggle").attr("aria-hidden","false").attr("aria-haspopup","true"),$PBJQ("#roleSwitchDropDown").attr("aria-hidden","true"),$PBJQ("#roleSwitchDropDownToggle").click(function(){$PBJQ("#roleSwitchDropDown").css("right",$PBJQ(window).width()-20-($PBJQ("#roleSwitchDropDownToggle").offset().left+$PBJQ("#roleSwitchDropDownToggle").width())),$PBJQ("#roleSwitchDropDown").toggleClass("open"),$PBJQ("#roleSwitchDropDown").is(".open")?($PBJQ("#roleSwitchDropDown").attr("aria-hidden","false"),$PBJQ(document.body).prepend('<div class="user-dropdown-overlay"></div>'),$PBJQ(".user-dropdown-overlay").on("click",function(){t()}),$PBJQ(document.body).on("keyup",e),setTimeout(function(){$PBJQ("#roleSwitchDropDown").find("a, :input").focus()})):($PBJQ("#roleSwitchDropDown").attr("aria-hidden","true"),$PBJQ(".user-dropdown-overlay").remove(),$PBJQ(document.body).off("keyup",e),$PBJQ("#roleSwitchDropDownToggle").focus())})}():$PBJQ("#roleSwitch").addClass("menu-not-setup")}),$PBJQ(".js-toggle-tools-nav","#skipNav").on("click",toggleToolsNav);var sessionTimeOut,timeoutDialogWarningTime,timeoutLoggedoutUrl,timeoutPortalPath,sessionId="current",timeoutDialogEnabled=!1;$PBJQ(document).ready(function(){portal.loggedIn&&portal.timeoutDialog&&setTimeout("setup_timeout_config();",6e4)});var setup_timeout_config=function(){timeoutDialogEnabled=portal.timeoutDialog.enabled,timeoutDialogWarningTime=portal.timeoutDialog.seconds,timeoutLoggedoutUrl=portal.loggedOutUrl,timeoutPortalPath=portal.portalPath,1==timeoutDialogEnabled&&(poll_session_data(),fetch_timeout_dialog())},poll_session_data=function(){$PBJQ.ajax({url:"/direct/session/"+sessionId+".json?auto=true&_="+(new Date).getTime(),dataType:"json",success:function(e){if(e.maxInactiveInterval=1e3*e.maxInactiveInterval,e.active&&null!=e.userId&&e.lastAccessedTime+e.maxInactiveInterval>e.currentTime){var t=e.lastAccessedTime+e.maxInactiveInterval-e.currentTime;sessionTimeOut=t<1e3*timeoutDialogWarningTime?(min=Math.round(t/6e4),show_timeout_alert(min),clearTimeout(sessionTimeOut),setTimeout("poll_session_data()",6e4)):(clearTimeout(sessionTimeOut),setTimeout("poll_session_data()",t-1e3*timeoutDialogWarningTime))}else null==e.userId?location.href=timeoutLoggedoutUrl:sessionTimeOut=setTimeout("poll_session_data()",1e4)},error:function(e,t,o){}})};function keep_session_alive(){dismiss_session_alert(),$PBJQ.get(timeoutPortalPath)}var timeoutDialogFragment,dismiss_session_alert=function(){removeDHTMLMask(),$PBJQ("#timeout_alert_body").remove()};function fetch_timeout_dialog(){$PBJQ.ajax({url:"/portal/timeout?auto=true",cache:!0,dataType:"text",success:function(e){timeoutDialogFragment=e},error:function(e,t,o){timeoutDialogEnabled=!1}})}function show_timeout_alert(e){if(timeoutDialogEnabled)if($PBJQ("#portalMask").get(0)||(createDHTMLMask(dismiss_session_alert),$PBJQ("#portalMask").css("z-index",1e3)),$PBJQ("#timeout_alert_body").get(0))$PBJQ("#timeout_alert_body span").html(e);else{var t=timeoutDialogFragment.replace("{0}",e);$PBJQ("body").append(t)}}function toggleShortUrlOutput(e,t,o){$PBJQ(t).is(":checked")?$PBJQ.ajax({url:"/direct/url/shorten?path="+encodeURI(e),dataType:"text",success:function(e){$PBJQ("."+o).val(e)}}):$PBJQ("."+o).val(e)}$PBJQ(document).ready(function(){$PBJQ(".Mrphs-toolTitleNav__link--directurl").click(function(e){var t=$PBJQ(this).position(),o=$PBJQ(this).siblings(".Mrphs-directUrl");o.toggleClass("active").css({left:t.left+"px"}),o.attr("aria-expanded","true"),o.find("[tabindex]").first().focus(),e.preventDefault()}),$modal_container=$PBJQ(".Mrphs-directUrl"),$modal_container.each(function(e){var t=$PBJQ(this).find("[tabindex]");t.first().on("keydown",function(e){if(9===e.keyCode&&e.shiftKey)return t.last().focus(),e.preventDefault(),!1}),t.last().on("keydown",function(e){if(9===e.keyCode&&!e.shiftKey)return t.first().focus(),e.preventDefault(),!1})}),$modal_container.last().on("keypress",function(e){if(9===e.keyCode())return console.log("keypress:: primero"),$modal_container.fist().focus(),e.preventDefault(),!1}),$PBJQ(".Mrphs-directUrl .dropDown_close").on("click keypress",function(e){var t=$PBJQ(this).parent();t.toggleClass("active"),t.removeAttr("aria-expanded"),$PBJQ('.Mrphs-toolTitleNav__link--directurl[rel="#'+t.attr("id")+'"]').focus(),e.preventDefault()})});var setupSkipNav=function(){$PBJQ("#skipNav a.Mrphs-skipNav__link").click(function(){var e=$PBJQ(this).attr("href");$PBJQ(e).attr("tabindex","-1").focus()})};$PBJQ(document).ready(function(){var o=0;$PBJQ(document).scroll(function(e){var t=$PBJQ(this).scrollTop();o<t&&90<t?($PBJQ(".Mrphs-topHeader").addClass("moving"),$PBJQ(".Mrphs-siteHierarchy").addClass("moving"),$PBJQ(".Mrphs-toolsNav__title--current-site").addClass("moving"),$PBJQ(".Mrphs-skipNav__menu").addClass("moving"),$PBJQ(".Mrphs-sitesNav__menuitem--myworkspace").addClass("moving")):(90<t||0==t)&&($PBJQ(".Mrphs-topHeader").removeClass("moving"),$PBJQ(".Mrphs-siteHierarchy").removeClass("moving"),$PBJQ(".Mrphs-toolsNav__title--current-site").removeClass("moving"),$PBJQ(".Mrphs-skipNav__menu").removeClass("moving"),$PBJQ(".Mrphs-sitesNav__menuitem--myworkspace").removeClass("moving")),o=t})});var closeAllDropdownMenus=function(){$PBJQ(".Mrphs-sitesNav__menuitem").removeClass("dropdown-is-visible"),$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-visible").removeClass("is-visible"),$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-clicked").removeClass("is-clicked"),$PBJQ(".sitenav-dropdown-overlay").remove()},buildDropdownMenu=function(t,e,o){var i='<ul class="Mrphs-sitesNav__submenu" role="menu">',a=parseInt($PBJQ("#linkNav").attr("data-max-tools-int")),n=$PBJQ("#linkNav").attr("data-max-tools-anchor"),r='<li class="Mrphs-sitesNav__submenuitem Mrphs-sitesNav__submenuitem__gotosite"><a tabindex="-1" role="menuitem" href="'+portal.portalPath+"/site/"+e+'" title="'+n+'"><span class="toolMenuIcon icon-sakai--see-all-tools"></span>'+n+"</a></li>",s="/direct/site/"+e+"/pages.json",l=window.location.pathname.split("/").pop();$PBJQ.ajax({url:s,dataType:"json",success:function(e){$PBJQ.each(e,function(e,t){if(t.tools&&!(t.tools.length<=0)){var o="";if(l==t.tools[0].id&&(o=" is-current"),e<=a){var n;if(t.toolpopup)n='<li class="Mrphs-sitesNav__submenuitem" ><a tabindex="-1" class="Mrphs-sitesNav__submenuitem-link"'+' role="menuitem" href="{{tool_url}}?sakai.popup=yes" title="{{item_title}}" onclick="window.open(\'{{item_toolpopupurl}}\');"'+'>  <span class="Mrphs-sitesNav__submenuitem-icon"><span class="toolMenuIcon icon-sakai--{{icon}}"></span></span>  <span class="Mrphs-sitesNav__submenuitem-title">{{item_title}}</span></a></li>';else n='<li class="Mrphs-sitesNav__submenuitem{{is_current}}"><a tabindex="-1" class="Mrphs-sitesNav__submenuitem-link"'+' role="menuitem" href="{{tool_url}}" title="{{item_title}}"'+'>  <span class="Mrphs-sitesNav__submenuitem-icon"><span class="toolMenuIcon icon-sakai--{{icon}}"></span></span>  <span class="Mrphs-sitesNav__submenuitem-title">{{item_title}}</span></a></li>';i+=n.replace(/{{tool_url}}/g,t.tools[0].url).replace(/{{item_title}}/g,t.title).replace(/{{item_toolpopupurl}}/g,t.toolpopupurl).replace(/{{icon}}/g,t.tools[0].toolId.replace(/\./gi,"-")).replace(/{{is_current}}/g,o)}}}),e.length-1>a&&(i+=r),i+="</ul>",i=$PBJQ(i),t.append(i),addArrowNavAndDisableTabNav(i),o(i)},error:function(e,t,o){}})},setupSiteNav=function(){$PBJQ("ul.Mrphs-sitesNav__menu").each(function(){$PBJQ(this).keydown(function(e){27==e.keyCode&&closeAllDropdownMenus()})}),$PBJQ(document).on("keydown",".Mrphs-sitesNav__menu > li.Mrphs-sitesNav__menuitem > a",function(e){if(40==e.keyCode){e.preventDefault();var t=$PBJQ(this).parent().find(".Mrphs-sitesNav__dropdown");t.data("clicked")||(t.data("clicked",!0),t.trigger("click"))}else 27==e.keyCode&&(e.preventDefault(),closeAllDropdownMenus())}),$PBJQ("ul.Mrphs-sitesNav__menu li .Mrphs-sitesNav__dropdown").click(function(e){e.preventDefault();var t=$PBJQ(e.target),o=t.parent(".Mrphs-sitesNav__menuitem"),n=o.hasClass("dropdown-is-visible");if(closeAllDropdownMenus(),!n){var i=$PBJQ(this),a=function(e){i.addClass("is-clicked"),o.addClass("dropdown-is-visible"),e.addClass("is-visible"),o.find("li a").first().focus();var t=$PBJQ('<div class="sitenav-dropdown-overlay" />');t.on("click",function(e){closeAllDropdownMenus()}),$PBJQ("body").prepend(t),i.removeData("clicked")};o.find("ul").length?a(o.find("ul")):buildDropdownMenu(o,t.attr("data-site-id"),a)}}).hover(function(){$PBJQ(this).toggleClass("Mrphs-sitesNav__dropdown--hover")})};function addArrowNavAndDisableTabNav(i){i.find("li a").attr("tabindex","-1").keydown(function(e){var t=$PBJQ(e.target);if(40==e.keyCode){e.preventDefault();var o=t.closest("li").next();0!==o.length&&0!=o.find("a").length||(o=i.find("li").first()),i.find("li a").attr("tabindex","-1"),o.find("a").focus().attr("tabindex","0")}else if(38==e.keyCode){e.preventDefault();var n=t.closest("li").prev();0===n.length&&(n=i.find("a").closest("ul")),i.find("li a").attr("tabindex","-1"),n.find("a").focus().attr("tabindex","0")}else 9==e.keyCode&&closeAllDropdownMenus()})}function updatePresence(){$PBJQ.ajax({url:sakaiPresenceFragment,cache:!1,success:function(e){var t=$PBJQ("#presenceIframe");t.html(e);var o=$PBJQ("#presenceCount");if(t.is(":empty"))return o.html(" "),o.removeClass("present").addClass("empty"),void location.reload();var n=t.find(".listUser").length;1<n?(o.html(n+""),o.removeClass("empty").addClass("present")):(1==n?$PBJQ("#presenceCount").html(n+""):$PBJQ("#presenceCount").html(" "),o.removeClass("present").addClass("empty"));var i=$PBJQ(".nav-selected .icon-sakai-chat").attr("href");$PBJQ("#presenceIframe .presenceList div.inChat span").wrap('<a href="'+i+'"></a>'),sakaiLastPresenceTimeOut=setTimeout("updatePresence()",3e4)},error:function(e,t){sakaiLastPresenceTimeOut=setTimeout("updatePresence()",6e4)}})}function userNavEscHandler(e){27===e.keyCode&&toggleUserNav(e)}function toggleUserNav(e){if(e.preventDefault(),$PBJQ(".Mrphs-userNav__subnav").toggleClass("is-hidden"),$PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden"))$PBJQ(".user-dropdown-overlay").remove(),$PBJQ(document).off("keyup",userNavEscHandler);else{var t=$PBJQ('<div class="user-dropdown-overlay" />');t.on("click",function(e){toggleUserNav(e)}),$PBJQ("body").prepend(t),$PBJQ(document).on("keyup",userNavEscHandler)}}portal=portal||{},void 0===portal.toolsCollapsed&&(portal.toolsCollapsed=!1),portal.updateToolsCollapsedPref=function(e){var t="/direct/userPrefs/updateKey/"+portal.user.id+"/sakai:portal:sitenav?toolsCollapsed="+e;$PBJQ.ajax(t,{method:"PUT",cache:!1})},portal.toggleMinimizeNav=function(){$PBJQ("body").toggleClass("Mrphs-toolMenu-collapsed"),$PBJQ("#subSites.floating").css({display:"none"});var e=$PBJQ(this);e.toggleClass("min max").parent().toggleClass("min max"),portal.toolsCollapsed?(portal.updateToolsCollapsedPref(!1),portal.toolsCollapsed=!1,e.attr("aria-pressed",!1)):(portal.updateToolsCollapsedPref(!0),portal.toolsCollapsed=!0,e.attr("aria-pressed",!0))},$PBJQ("#toolsNav-toggle-li button").on("click",portal.toggleMinimizeNav),$PBJQ(document).ready(function(){$PBJQ("#toggleSubsitesLink").click(function(e){var t=$PBJQ(this);if("block"==$PBJQ("#subSites").css("display"))$PBJQ("#subSites").hide(),$PBJQ("#subSites").removeClass("floating");else{var o=t.position(),n=-1*($PBJQ("#toolMenu").height()-o.top),i=MorpheusViewportHelper.isPhone()?{display:"block",top:0,overflow:"hidden"}:{display:"block",left:$PBJQ("#toolMenu").width()+7+"px",top:n+"px"};$PBJQ("#subSites").css(i),$PBJQ("#subSites").addClass("floating"),$PBJQ("#subSites").find("li a").first().focus(),$PBJQ("#toggleSubsitesLink").position().top<240&&$PBJQ("#subSites.floating").addClass("ontop")}})}),$PBJQ("#loginLink1").click(function(e){""===$PBJQ(this).attr("data-warning")||confirm($PBJQ(this).attr("data-warning"))||e.preventDefault()}),$PBJQ(".js-toggle-user-nav a#loginUser > .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav),$PBJQ(".js-toggle-user-nav .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav),$PBJQ(".Mrphs-userNav__pic-changer").on("click",function(e){var t=$PBJQ(this);if(!window.FileReader)return $PBJQ(t.data("profileLink")).trigger("click"),!0;if(!$PBJQ.fn.modal)return $PBJQ(t.data("profileLink")).trigger("click"),!0;function o(e){var t;l.show(),l.find("> img").cropper("clear"),l.find("> img").cropper("replace",e),r.removeProp("disabled"),t=$PBJQ("#cropToolbar").show(),portal.pictureToolbarSetup||($PBJQ(".profile-image-zoom-in",t).on("click",function(){l.find("> img").cropper("zoom",.1)}),$PBJQ(".profile-image-zoom-out",t).on("click",function(){l.find("> img").cropper("zoom",-.1)}),$PBJQ(".profile-image-pan-up",t).on("click",function(){l.find("> img").cropper("move",0,-10)}),$PBJQ(".profile-image-pan-down",t).on("click",function(){l.find("> img").cropper("move",0,10)}),$PBJQ(".profile-image-pan-left",t).on("click",function(){l.find("> img").cropper("move",10,0)}),$PBJQ(".profile-image-pan-right",t).on("click",function(){l.find("> img").cropper("move",-10,0)}),$PBJQ(".profile-image-rotate",t).on("click",function(){l.find("> img").cropper("clear"),l.find("> img").cropper("rotate",90),l.find("> img").cropper("crop")}),portal.pictureToolbarSetup=!0)}function n(){$PBJQ.getJSON("/direct/profile-image/details?_="+(new Date).getTime(),function(e){"SUCCESS"==e.status&&(e.isDefault||(o(e.url+"?_="+(new Date).getTime()),$PBJQ(".remove-profile-image").on("click",function(){a.find(".modal-body .alert").hide(),$PBJQ.ajax("/direct/profile-image/remove",{data:{sakai_csrf_token:sakai_csrf_token},type:"POST",dataType:"json",success:function(e,t,o){"SUCCESS"==e.status?(i(),$PBJQ("#cropToolbar").hide()):$PBJQ("#remove-error").show()}})}))),sakai_csrf_token=e.csrf_token})}function i(){var e=$PBJQ("#loginUser > .Mrphs-userNav__submenuitem--profilepicture"),t=e.parent();e.detach();var o=new Date,n="background-image: url(/direct/profile/"+portal.user.id+"/image/thumb?"+o.getTime()+")";e.attr("style",n),t.prepend(e),t=(e=$PBJQ(".Mrphs-userNav__submenuitem--profilelink > .Mrphs-userNav__submenuitem--profilepicture")).parent(),e.detach(),e.attr("style",n),t.prepend(e),$PBJQ("#profileImageUpload").modal("hide")}e.preventDefault(),e.stopImmediatePropagation();var a=$PBJQ("#profileImageUpload");a.on("shown.bs.modal",function(){n()}),a.modal({width:320}),$PBJQ("#remove-error").hide(),$PBJQ("#upload-error").hide();var r=a.find("#save"),s=$PBJQ("#file"),l=$PBJQ("#cropme").hide();return l.find("> img").cropper({aspectRatio:1,checkCrossOrigin:!1,guides:!0,minContainerWidth:300,minContainerHeight:300,autoCropArea:1,viewMode:1,dragMode:"move"}),s.on("change",function(){$PBJQ(this);if(!this.files||!this.files[0])throw"Browser does not support FileReader";var e=new FileReader;e.onload=function(e){o(e.target.result)},e.readAsDataURL(this.files[0])}),r.on("click",function(e){new Promise(function(e){e(l.find("> img").cropper("getCroppedCanvas",{width:200,height:200}).toDataURL())}).then(function(e){var t;t=e.replace(/^data:image\/(png|jpg);base64,/,""),a.find(".modal-body .alert").hide(),$PBJQ.ajax("/direct/profile-image/upload",{data:{sakai_csrf_token:sakai_csrf_token,base64:t},type:"POST",dataType:"json",success:function(e,t,o){"SUCCESS"==e.status?i():$PBJQ("#upload-error").show()}})})}),!1});var header=$PBJQ(".Mrphs-topHeader"),currentHeaderWidth=-1;function f_scrollTop(){return f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}function f_filterResults(e,t,o){var n=e||0;return t&&(!n||t<n)&&(n=t),o&&(!n||o<n)?o:n}$PBJQ(document).ready(function(){$PBJQ(header).data("sticked",!1),0<$PBJQ(".Mrphs-hierarchy--parent-sites").length&&$PBJQ(window).width()<=800&&$PBJQ("#content").css("margin-top",parseInt($PBJQ("#content").css("margin-top").replace("px",""))+$PBJQ(".Mrphs-hierarchy--parent-sites").outerHeight(!0)+"px"),$PBJQ(window).resize(function(){currentHeaderWidth=$PBJQ(".Mrphs-mainHeader").width()}),$PBJQ(window).scroll(function(){var e=$PBJQ(document).height()-$PBJQ(window).height()>$PBJQ(header).height()==!0;0<$PBJQ(window).scrollTop()?!1===$PBJQ(header).data("sticked")&&!0===e&&($PBJQ(header).data("sticked",!0),$PBJQ(".Mrphs-mainHeader").addClass("is-fixed")):($PBJQ(".Mrphs-mainHeader").removeClass("is-fixed"),$PBJQ(header).data("sticked",!1))}),currentHeaderWidth=$PBJQ(".Mrphs-mainHeader").width(),$PBJQ(".Mrphs-headerLogo").on("click",function(){document.body.scrollTop=0,document.body.scrollLeft=0,$PBJQ(window).trigger("scroll")})}),$PBJQ(document).ready(function(){$PBJQ("input, textarea","#content").each(function(){$PBJQ(this).prop("disabled")&&$PBJQ(this).parent("label").addClass("disabled")}),$PBJQ(document).keyup(function(e){27==e.keyCode&&($PBJQ("#selectSiteModal").hasClass("outscreen")||$PBJQ("#otherSitesMenu .otherSitesMenuClose").trigger("click"),$PBJQ(".Mrphs-directUrl__dropDown").each(function(){$PBJQ(this).hasClass("active")&&$PBJQ(this).find(".dropDown_close").trigger("click")}),$PBJQ(".fip-icon-up-dir").trigger("click"),$PBJQ(".navigatePanelControls .close").trigger("click"))})});var MorpheusViewportHelper={isPhone:function(){return $PBJQ("#Mrphs-viewport-helpers .phone").is(":visible")},isTablet:function(){return $PBJQ("#Mrphs-viewport-helpers .tablet").is(":visible")},isDesktop:function(){return $PBJQ("#Mrphs-viewport-helpers .desktop").is(":visible")},isNonPhone:function(){return(this.isDesktop()||this.isTablet())&&!this.isPhone()}};$PBJQ(document).ready(function(){1==$PBJQ("#loginLink2").length&&$PBJQ("#loginLink2").click(function(e){$PBJQ("body").append('<div id="Mrphs-xlogin-container" />'),$PBJQ("#Mrphs-xlogin-container").load("/portal/xlogin #Mrphs-xlogin",function(){$PBJQ("#Mrphs-xlogin-container").addClass("loaded"),$PBJQ("#Mrphs-xlogin").addClass("loadedByAjax"),$PBJQ("#eid").focus()}),$PBJQ(".Mrphs-portalWrapper").addClass("blurry"),$PBJQ("body").append('<div id="loginPortalMask" />'),$PBJQ("#loginPortalMask").bgiframe(),$PBJQ("#loginPortalMask").click(function(){$PBJQ("#loginPortalMask").remove(),$PBJQ("#Mrphs-xlogin-container").remove(),$PBJQ(".Mrphs-portalWrapper").removeClass("blurry")}),e.preventDefault()})});
/* Compiled on 2019-01-27_11-13-01 */
